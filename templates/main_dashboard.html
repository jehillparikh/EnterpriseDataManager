<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mutual Fund API Dashboard</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <style>
        .upload-section {
            border: 2px dashed var(--bs-border-color);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            transition: border-color 0.3s ease;
        }
        .upload-section:hover {
            border-color: var(--bs-primary);
        }
        .api-endpoint {
            background: var(--bs-dark);
            border: 1px solid var(--bs-border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .method-badge {
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin-right: 0.5rem;
        }
        .method-get { background-color: var(--bs-success); color: white; }
        .method-post { background-color: var(--bs-primary); color: white; }
        .method-put { background-color: var(--bs-warning); color: black; }
        .method-delete { background-color: var(--bs-danger); color: white; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
                    <div class="container">
                        <a class="navbar-brand" href="/">
                            <strong>Mutual Fund API</strong>
                        </a>
                        <span class="navbar-text">
                            Enterprise Financial Services Platform
                        </span>
                    </div>
                </nav>
            </div>
        </div>

        <div class="container">
            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="api-tab" data-bs-toggle="tab" data-bs-target="#api-panel" type="button" role="tab">
                        API Testing
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload-panel" type="button" role="tab">
                        Data Upload
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="mainTabContent">
                <!-- API Testing Tab -->
                <div class="tab-pane fade show active" id="api-panel" role="tabpanel">
                    <div class="row">
                        <div class="col-12">
                            <h2>API Testing Interface</h2>
                            <p class="lead">Test the mutual fund API endpoints directly from this interface.</p>
                        </div>
                    </div>

                    <!-- Fund Endpoints -->
                    <div class="api-endpoint">
                        <h4>Fund Information</h4>
                        <div class="mb-3">
                            <span class="method-badge method-get">GET</span>
                            <code>/api/funds</code>
                            <p class="mt-2">Get all funds with optional filtering</p>
                            <button class="btn btn-success btn-sm" onclick="testEndpoint('/api/funds')">Test</button>
                        </div>
                        <div class="mb-3">
                            <span class="method-badge method-get">GET</span>
                            <code>/api/funds/{isin}</code>
                            <p class="mt-2">Get specific fund by ISIN</p>
                            <input type="text" class="form-control mb-2" id="fund-isin" placeholder="Enter ISIN (e.g., INF123456789)">
                            <button class="btn btn-success btn-sm" onclick="testFundByIsin()">Test</button>
                        </div>
                    </div>

                    <!-- Test Results -->
                    <div class="api-endpoint">
                        <h4>Test Results</h4>
                        <pre id="api-results" class="bg-secondary p-3 rounded" style="max-height: 400px; overflow-y: auto;">
Click any "Test" button above to see API responses here...
                        </pre>
                    </div>
                </div>

                <!-- Data Upload Tab -->
                <div class="tab-pane fade" id="upload-panel" role="tabpanel">
                    <div class="row">
                        <div class="col-12">
                            <h2>Data Upload</h2>
                            <p class="lead">Upload Excel files to import fund data into the system.</p>
                        </div>
                    </div>

                    <!-- Upload Section -->
                    <div class="upload-section">
                        <h4>Upload Excel File</h4>
                        <p>Select an Excel file containing fund data (factsheets, portfolios, returns, or NAV data)</p>
                        <input type="file" id="fileInput" accept=".xlsx,.xls" class="form-control mb-3">
                        <button class="btn btn-primary" onclick="uploadFile()">Upload File</button>
                    </div>

                    <!-- Upload Results -->
                    <div id="upload-results" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function testEndpoint(endpoint) {
            const resultsElement = document.getElementById('api-results');
            resultsElement.textContent = 'Loading...';

            try {
                const response = await fetch(endpoint);
                const data = await response.json();
                resultsElement.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                resultsElement.textContent = `Error: ${error.message}`;
            }
        }

        async function testFundByIsin() {
            const isin = document.getElementById('fund-isin').value.trim();
            if (!isin) {
                alert('Please enter an ISIN');
                return;
            }
            await testEndpoint(`/api/funds/${isin}`);
        }

        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const resultsDiv = document.getElementById('upload-results');
            
            if (!fileInput.files[0]) {
                alert('Please select a file first');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            resultsDiv.innerHTML = '<div class="alert alert-info">Uploading file...</div>';

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultsDiv.innerHTML = `
                        <div class="alert alert-success">
                            <strong>Upload Successful!</strong><br>
                            ${result.message}
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <strong>Upload Failed:</strong><br>
                            ${result.error || 'Unknown error occurred'}
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>